property controlNew ${control:mapNew("target/nukleus-itests/tcp/control", 1024, 1024)}

accept agrona://stream/bidirectional
       option reader ${agrona:manyToOneReader(controlNew.nukleus)}
       option writer ${agrona:broadcastTransmitter(controlNew.controller)}

accepted
connected

read [0x00 0x00 0x00 0x03]
read ([0..8]:correlationId)
read [0x0b] "destination"
read [0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00]
read [0x06] "source"
read [0x01] [0x7f 0x00 0x00 0x01]
read [0x1f 0x90]

write [0x40 0x00 0x00 0x03]
write ${correlationId}
write [0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x01]
write flush

read [0x00 0x00 0x00 0x05]
read ([0..8]:correlationId)
read [0..8]

write [0x40 0x00 0x00 0x05]
write ${correlationId}
write [0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00]
write flush

close
closed
